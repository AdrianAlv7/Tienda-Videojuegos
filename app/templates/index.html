{% extends "base.html" %}
{% set body_class = "index-page" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}?v=2">
{% endblock %}

{% block content %}

<!-- LOGO GRANDE INDEX -->
<img src="{{ url_for('static', filename='IMG/logo.png') }}" class="logo-img logo-index" alt="Logo grande">

<!-- HERO / CARRUSEL -->
<div class="carousel-container">
  {% if juegos %}
  <div class="carousel" id="carousel">
    {% for j in juegos[:5] %}
    <div class="carousel-slide" onclick="window.location.href='{{ url_for('main.juego_detalle', id=j.id, origen='index') }}'">
      <img src="{{ url_for('static', filename='IMG/productos/' + (j.imagen if j.imagen else 'default.png')) }}">
      <div class="carousel-info">
        <h2>{{ j.nombre }}</h2>
        <p>{{ j.descripcion }}</p>
        <span class="price-tag">${{ "%.2f"|format(j.precio) }}</span>
      </div>
    </div>
    {% endfor %}
  </div>

  <button id="prev" class="carousel-btn">❮</button>
  <button id="next" class="carousel-btn">❯</button>

  <div class="carousel-indicators">
    {% for j in juegos[:5] %}
    <div class="indicator {% if loop.first %}active{% endif %}"></div>
    {% endfor %}
  </div>
  {% endif %}
</div>


<!-- JUEGOS RECIENTES -->
<div class="section">
  <h2>Juegos Recientes</h2>
  <p>Explora los últimos títulos que has adquirido.</p>

  <div class="games-grid">
    {% for j in juegos[:6] %}
    <div class="game-card">
      <img src="{{ url_for('static', filename='IMG/productos/' + (j.imagen if j.imagen else 'default.png')) }}">
      <h4>{{ j.nombre }}</h4>
      <a href="{{ url_for('main.juego_detalle', id=j.id, origen='index') }}" class="btn-gamer">
        ${{ "%.2f"|format(j.precio) }}
      </a>
    </div>
    {% endfor %}
  </div>
</div>


<!-- CTA TIENDA -->
<div class="section store-section">
  <div class="store-cta">

    <div class="store-cta-text">
      <h2>Explora la Tienda</h2>
      <p>Descubre lanzamientos, clásicos y ofertas exclusivas.</p>

      <div class="store-pills">
        <span class="store-pill">Nuevos lanzamientos</span>
        <span class="store-pill">Ofertas destacadas</span>
        <span class="store-pill">Tu biblioteca digital</span>
      </div>
    </div>

    <div class="store-cta-action">
      <a href="{{ url_for('main.tienda') }}" class="btn-gamer btn-store">
        Explorar tienda
      </a>
    </div>

    <div class="store-cta-image">
      <img src="{{ url_for('static', filename='IMG/default.jpg') }}" alt="Tienda">
      <div class="store-cta-glow"></div>
    </div>

  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {

    const carousel = document.getElementById("carousel");
    const slides = document.querySelectorAll(".carousel-slide");
    const indicators = document.querySelectorAll(".indicator");
    const nextBtn = document.getElementById("next");
    const prevBtn = document.getElementById("prev");

    if (!carousel || slides.length === 0) return;

    let index = 0;
    const total = slides.length;

    /* === Actualizar carrusel === */
    function updateCarousel() {
        carousel.style.transform = `translateX(-${index * 100}%)`;

        indicators.forEach((dot, i) =>
            dot.classList.toggle("active", i === index)
        );
    }

    /* === Botón Siguiente === */
    function nextSlide() {
        index = (index + 1) % total;
        updateCarousel();
    }

    /* === Botón Anterior === */
    function prevSlide() {
        index = (index - 1 + total) % total;
        updateCarousel();
    }

    /* === Listeners botones === */
    nextBtn.addEventListener("click", nextSlide);
    prevBtn.addEventListener("click", prevSlide);

    /* === Click en indicadores === */
    indicators.forEach((dot, i) => {
        dot.addEventListener("click", () => {
            index = i;
            updateCarousel();
        });
    });

    /* === Autoplay === */
    let auto = setInterval(nextSlide, 6000);

    carousel.addEventListener("mouseenter", () => clearInterval(auto));
    carousel.addEventListener("mouseleave", () => auto = setInterval(nextSlide, 6000));

    updateCarousel();
});
</script>
{% endblock %}
