{% extends 'base.html' %}
{% block title %}Tienda - ActiveLife{% endblock %}
{% set active_page = 'tienda' %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tienda.css') }}">
{% endblock %}

{% block content %}
<h1 class="mt-4 text-center">Tienda de Videojuegos</h1>

<div class="tienda-layout">

  <!-- üïπÔ∏è Zona de juegos -->
  <div class="games-container">
    {% for juego in juegos %}
      <div class="game-card" data-id="{{ juego.id }}">
        <!-- Imagen -->
        <img 
          src="{{ url_for('static', filename='IMG/productos/' + (juego.imagen if juego.imagen else 'default.png')) }}" 
          alt="{{ juego.nombre }}" 
          class="game-image"
        >

        <!-- Info principal -->
        <div class="game-info">
          <div class="game-title">{{ juego.nombre }}</div>
          <p class="game-desc">{{ juego.descripcion[:80] }}...</p>

          <div class="game-footer">
            <div class="game-price">${{ '%.2f'|format(juego.precio|float) }}</div>

            <button 
              class="btn 
                {% if juego.estado == 'biblioteca' %}btn-secondary
                {% elif juego.estado == 'carrito' %}btn-warning
                {% else %}btn-success{% endif %}" 
              data-product-id="{{ juego.id }}" 
              data-state="{{ juego.estado }}">
              {% if juego.estado == 'biblioteca' %}
                En biblioteca
              {% elif juego.estado == 'carrito' %}
                En carrito
              {% else %}
                Agregar al carrito
              {% endif %}
            </button>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

{% endblock %}


{% block extra_js %}
<script>
/* üéØ Permite abrir el detalle del juego al hacer clic en la tarjeta */
document.querySelectorAll(".game-card").forEach(card => {
  card.addEventListener("click", (e) => {
    if (e.target.closest("button")) return; // evita conflicto con bot√≥n
    const id = card.dataset.id;
    window.location.href = `/juego/${id}`;
  });
});
</script>
{% endblock %}



