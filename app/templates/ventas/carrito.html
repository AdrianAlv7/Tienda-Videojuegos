{% extends "base.html" %}
{% block title %}Mi Carrito - ActiveLife{% endblock %}

{% block extra_css %}
<style><style>
:root {
  --morado: #8b3dff;
  --morado-oscuro: #3a0a74;
  --neon: #c47cff;
  --verde-neon: #2ebf60;
  --bg-soft: rgba(255,255,255,0.05);
}

body {
  background: #0a0712;
  color: #eee;
  font-family: 'Poppins', sans-serif;
}

/* üî• NUEVO: Carrito m√°s grande */
.container {
  max-width: 1100px; /* antes 900px */
  margin: 3rem auto;
}

/* T√≠tulo */
h2 {
  color: var(--neon);
  margin-bottom: 2.5rem;
  text-align: center;
  font-size: 2.3rem; /* m√°s grande */
  font-weight: 700;
  text-shadow: 0 0 12px var(--neon), 0 0 20px var(--morado);
}

/* Caja general */
.cart-box {
  background: rgba(255,255,255,0.04);
  border-radius: 16px;
  padding: 2rem;
  box-shadow: 0 0 30px rgba(138, 54, 255, 0.2);
  border: 1px solid rgba(255,255,255,0.1);
}

/* üî• ITEM M√ÅS GRANDE, M√ÅS ESPACIO */
.cart-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 25px;

  background: rgba(255,255,255,0.04);
  padding: 18px 24px;
  border-radius: 14px;
  margin-bottom: 18px;
  border: 1px solid rgba(255,255,255,0.06);
  transition: 0.25s ease;
  cursor: pointer;
}

.cart-item:hover {
  background: rgba(136, 72, 255, 0.18);
  border-color: var(--neon);
  transform: translateY(-4px);
  box-shadow: 0 0 20px rgba(196,124,255,0.35);
}

/* contenedor imagen + texto */
.cart-left {
  display: flex;
  align-items: center;
  gap: 20px;
  flex: 1; /* ‚≠ê esto hace que el texto NO se desacomode */
}

/* Imagen */
.cart-item img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.12);
  box-shadow: 0 0 12px rgba(138, 54, 255, 0.4);
}

/* Texto */
.name {
  font-size: 1.2rem;
  font-weight: 600;
  color: #fff;
}

.desc {
  font-size: 0.9rem;
  color: #bbb;
}

/* Precio */
.price {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--verde-neon);
  text-shadow: 0 0 10px rgba(46,191,96,0.5);
  min-width: 120px; 
  text-align: right;
}


/* precio */
.price {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--verde-neon);
  text-shadow: 0 0 10px rgba(46,191,96,0.5);
}

/* Bot√≥n eliminar */
/* ===================================
   BOT√ìN DE ELIMINAR (TAMA√ëO FIJO)
   =================================== */

.btn-remove {
  width: 55px;
  height: 55px;
  background: linear-gradient(135deg, #250047, #3a0a74);
  border: 1px solid #8b3dff;
  color: #d7b8ff;
  border-radius: 12px;
  cursor: pointer;
  transition: 0.25s ease;
  position: relative;
  overflow: hidden;
  font-size: 1.6rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-remove:hover {
  color: #fff;
  border-color: var(--neon);
  box-shadow: 0 0 15px var(--neon);
}

/* Shine */
.btn-remove::after {
  content: "";
  position: absolute;
  top: 0;
  left: -90%;
  width: 70%;
  height: 100%;
  background: linear-gradient(120deg, transparent, rgba(255,255,255,0.4), transparent);
  transform: skewX(-20deg);
  transition: 0.5s;
}

.btn-remove:hover::after {
  left: 130%;
}

/* =============================
   TOTAL Y BOTONES DE ACCI√ìN
   ============================= */

.total-section {
  margin-top: 2.5rem;
  border-top: 1px solid rgba(255,255,255,0.12);
  padding-top: 1.8rem;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 2rem;
}

.total-amount {
  font-size: 2rem; /* m√°s grande */
  font-weight: 700;
  color: var(--verde-neon);
  text-shadow: 0 0 12px rgba(46,191,96,0.6);
}

/* ‚úî BOTONES M√ÅS A LA DERECHA */
.actions {
  display: flex;
  justify-content: flex-end;
  gap: 16px;
  margin-top: 1.5rem;
}

/* Botones */
.actions .btn {
  background: linear-gradient(135deg, #7b2ff7, #d17bff);
  color: #fff;
  border: none;
  border-radius: 14px;
  padding: 14px 26px;
  cursor: pointer;
  font-size: 1.1rem;
  font-weight: 700;
  transition: 0.25s ease;
  width: 240px;
  text-align: center;
  position: relative;
  overflow: hidden;
  box-shadow: 0 0 18px rgba(155, 70, 255, 0.45);
}

.actions .btn:hover {
  filter: brightness(1.25);
  box-shadow: 0 0 24px rgba(211, 130, 255, 0.65);
}


/* Shine animado */
.actions .btn::after {
  content: "";
  position: absolute;
  top: 0;
  left: -90%;
  width: 70%;
  height: 100%;
  background: linear-gradient(120deg, transparent, rgba(255,255,255,0.4), transparent);
  transform: skewX(-20deg);
  transition: 0.45s;
}

.actions .btn:hover::after {
  left: 130%;
}

/* Bot√≥n negro */
.actions .btn.secondary {
  background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
  border: 1px solid #555;
}

.actions .btn.secondary:hover {
  border-color: var(--neon);
  box-shadow: 0 0 14px var(--neon);
}

/* carrito vac√≠o */
.empty {
  text-align: center;
  color: #bbb;
  padding: 2.3rem 0;
  font-size: 1.3rem;
}
</style>

{% endblock %}

{% block content %}
<div class="container">
  <h2>Mi Carrito</h2>
  <div class="cart-box" id="cartBox">
    {% if items %}
      {% for it in items %}
      <div class="cart-item" data-id="{{ it[0] }}" onclick="window.location.href='{{ url_for('main.juego_detalle', id=it[0]) }}'">
        <div class="cart-left">
          <img src="{{ url_for('static', filename='IMG/productos/' + (it[4] if it[4] else 'default.png')) }}" alt="{{ it[1] }}">
          <div>
            <div class="name">{{ it[1] }}</div>
            <div class="desc">{{ it[2] }}</div>
          </div>
        </div>

        <div class="price">${{ '%.2f'|format(it[3]) }}</div>

        <button class="btn-remove" onclick="event.stopPropagation(); removeItem({{ it[0] }})">‚úï</button>
      </div>
      {% endfor %}
    {% else %}
      <div class="empty">Tu carrito est√° vac√≠o</div>
    {% endif %}
  </div>

  {% if items %}
  <div class="total-section">
    <div class="total-amount">Total: ${{ '%.2f'|format(total) }}</div>
  </div>

  <div class="actions" style="justify-content: flex-end; margin-top: 1rem;">
    <button class="btn secondary" onclick="vaciar()">Vaciar carrito</button>
    <button class="btn" onclick="checkout()">Proceder al pago ‚Üí</button>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// üóëÔ∏è Eliminar producto
async function removeItem(idProducto) {
  const res = await fetch("{{ url_for('carrito.carrito_quitar') }}", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id_producto: idProducto })
  });
  const data = await res.json();
  if (data.ok) {
    document.querySelector(`.cart-item[data-id="${idProducto}"]`)?.remove();
    updateBadge(data.count);
    if (!document.querySelector('.cart-item')) {
      document.getElementById('cartBox').innerHTML = '<div class="empty">Tu carrito est√° vac√≠o üõí</div>';
      document.querySelector('.total-section')?.remove();
      document.querySelector('.actions')?.remove();
    } else {
      document.querySelector('.total-amount').textContent = `Total: $${data.total.toFixed(2)}`;
    }
  }
}

// üßπ Vaciar todo el carrito
async function vaciar() {
  const res = await fetch("{{ url_for('carrito.carrito_vaciar') }}", { method: "POST" });
  const data = await res.json();
  if (data.ok) {
    document.getElementById('cartBox').innerHTML = '<div class="empty">Tu carrito est√° vac√≠o üõí</div>';
    document.querySelector('.total-section')?.remove();
    document.querySelector('.actions')?.remove();
    updateBadge(0);
  }
}

// üí≥ Proceder al pago
async function checkout() {
  window.location.href = "{{ url_for('carrito.carrito_checkout') }}";
}



// üî¢ Actualizar contador global
function updateBadge(n) {
  const badge = document.getElementById('cart-badge');
  if (!badge) return;
  badge.textContent = n;
  badge.style.display = n > 0 ? 'inline-flex' : 'none';
}
</script>
{% endblock %}
