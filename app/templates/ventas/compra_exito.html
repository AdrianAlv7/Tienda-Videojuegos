{% extends "base.html" %}
{% block title %}Compra Realizada - ActiveLife{% endblock %}

{% block extra_css %}
<style>
:root {
  --morado: #8b3dff;
  --morado-oscuro: #3a0a74;
  --neon: #c47cff;        /* rosa neon */
  --neon-soft: #e4b3ff;   /* lila brillante */
}

/* =========================
   FONDO + LAYOUT GENERAL
   ========================= */
.main-wrapper {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: calc(100vh - 120px);
  background: #050214;
  overflow: hidden;
}

/* Canvas de estrellas */
#starfield {
  position: absolute;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* Shader morado suave */
.shader-bg {
  position: absolute;
  inset: -80px;
  background:
    radial-gradient(circle at 0% 0%, rgba(139,61,255,0.45), transparent 60%),
    radial-gradient(circle at 100% 0%, rgba(196,124,255,0.45), transparent 55%),
    radial-gradient(circle at 50% 100%, rgba(160,80,255,0.35), transparent 60%);
  filter: blur(40px);
  opacity: 0.75;
  animation: shaderMove 25s ease-in-out infinite alternate;
  z-index: 1;
}

@keyframes shaderMove {
  0%   { transform: translate(-30px, -20px) scale(1); }
  50%  { transform: translate(20px, 30px) scale(1.05); }
  100% { transform: translate(10px, -10px) scale(1.02); }
}

/* =========================
   CAJA CRISTAL PRINCIPAL
   ========================= */
.success-box {
  position: relative;
  background: rgba(15, 10, 35, 0.9);
  border-radius: 22px;
  padding: 3.5rem 4rem;
  width: 95%;
  max-width: 820px;
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid rgba(255,255,255,0.16);
  box-shadow:
    0 0 32px rgba(139,61,255,0.6),
    0 0 60px rgba(0,0,0,0.9);
  text-align: center;
  z-index: 2;
  animation: fadeInUp 0.7s ease-out;
  overflow: hidden;
}

.success-box::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at top, rgba(196,124,255,0.25), transparent 70%);
  pointer-events: none;
  opacity: 0.7;
}

/* Icono */
.success-icon {
  font-size: 5.2rem;
  margin-bottom: 1rem;
  color: var(--neon);
  text-shadow:
    0 0 16px rgba(196,124,255,0.8),
    0 0 30px rgba(196,124,255,0.6);
  animation: checkPop 0.7s ease-out;
}

/* T√≠tulo */
.success-title {
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: 0.8rem;
  color: #fff;
  text-shadow:
    0 0 12px var(--neon),
    0 0 24px var(--morado);
}

/* Mensaje */
.success-msg {
  font-size: 1.1rem;
  color: #ccc;
  margin-bottom: 1.8rem;
}

/* Total */
.total-box {
  background: rgba(80, 30, 150, 0.35);
  border-radius: 16px;
  padding: 1.3rem 2.4rem;
  margin: 2rem auto 2.4rem auto;
  width: fit-content;
  font-size: 1.6rem;
  font-weight: 700;
  color: var(--neon-soft);
  border: 1px solid rgba(200, 170, 255, 0.5);
  box-shadow:
    0 0 18px rgba(180,120,255,0.35),
    0 0 26px rgba(180,120,255,0.6);
  text-shadow: 0 0 10px rgba(180,120,255,0.8);
}

/* =========================
   BOTONES
   ========================= */
.btns {
  display: flex;
  justify-content: center;
  gap: 22px;
  margin-top: 1rem;
}

.btns a {
  text-decoration: none;
  padding: 15px 28px;
  border-radius: 14px;
  font-weight: 700;
  font-size: 1.05rem;
  transition: all 0.25s ease;
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

/* Shine */
.btns a::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 70%;
  height: 100%;
  background: linear-gradient(120deg, transparent, rgba(255,255,255,0.35), transparent);
  transform: skewX(-20deg);
  transition: 0.5s;
}
.btns a:hover::after {
  left: 130%;
}

/* Bot√≥n primario */
.btn-primary {
  background: linear-gradient(135deg, var(--morado), var(--neon));
  color: #fff;
  box-shadow: 0 0 18px rgba(155,70,255,0.8);
}
.btn-primary:hover {
  filter: brightness(1.2);
  box-shadow: 0 0 26px rgba(195,110,255,1);
}

/* Bot√≥n secundario */
.btn-secondary {
  background: rgba(255,255,255,0.06);
  color: #ddd;
  border: 1px solid rgba(255,255,255,0.2);
}
.btn-secondary:hover {
  background: rgba(255,255,255,0.12);
  color: #fff;
  box-shadow: 0 0 18px rgba(180,120,255,0.45);
}

/* =========================
   GRID RESUMEN DE JUEGOS
   ========================= */
.games-section {
  margin-top: 2rem;
  text-align: left;
}

.games-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: #f3e8ff;
  margin-bottom: 1rem;
  text-shadow: 0 0 10px rgba(196,124,255,0.9);
}

.games-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
  gap: 18px;
}

.game-card {
  background: rgba(15, 8, 40, 0.9);
  border-radius: 16px;
  border: 1px solid rgba(200, 170, 255, 0.4);
  box-shadow: 0 0 16px rgba(155,70,255,0.55);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.game-thumb {
  width: 100%;
  height: 110px;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  filter: saturate(1.15);
}

.game-info {
  padding: 0.7rem 0.9rem 0.9rem 0.9rem;
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
}

.game-name {
  font-size: 0.95rem;
  font-weight: 600;
  color: #fff;
}

.game-price {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--neon-soft);
  text-shadow: 0 0 6px rgba(200,170,255,0.8);
}

.game-tag {
  font-size: 0.75rem;
  color: #cbb5ff;
  opacity: 0.9;
}

/* Animaciones */
@keyframes fadeInUp {
  0% { opacity: 0; transform: translateY(18px); }
  100% { opacity: 1; transform: translateY(0); }
}

@keyframes checkPop {
  0%   { transform: scale(0.3); opacity: 0; }
  60%  { transform: scale(1.1); opacity: 1; }
  100% { transform: scale(1); }
}

/* Responsive */
@media (max-width: 768px) {
  .success-box {
    padding: 2.5rem 1.8rem;
  }
}
</style>
{% endblock %}


{% block content %}
<div class="main-wrapper">
  <!-- Fondo procedural de estrellas -->
  <canvas id="starfield"></canvas>

  <!-- Shader morado suave -->
  <div class="shader-bg"></div>

  <div class="success-box">
    <div class="success-title">¬°Compra realizada con √©xito!</div>

    <div class="success-msg">
      Tus juegos ya est√°n disponibles en tu biblioteca
    </div>

    <div class="total-box">
      Total pagado: ${{ "%.2f"|format(total) }}
    </div>

    {% if items %}
    <div class="games-section">
      <div class="games-title">Resumen de tus juegos</div>
      <div class="games-grid">
        {% for it in items %}
        <div class="game-card">
          <div class="game-thumb"
               style="background-image: url('{{ url_for('static', filename='IMG/productos/' + (it[4] if it[4] else 'default.png')) }}');">
          </div>
          <div class="game-info">
            <span class="game-name">{{ it[1] }}</span>
            <span class="game-price">${{ '%.2f'|format(it[3]) }}</span>
            <span class="game-tag">A√±adido a tu biblioteca</span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <div class="btns">
      <a href="{{ url_for('main.biblioteca') }}" class="btn-primary">Ver mi biblioteca</a>
      <a href="{{ url_for('main.tienda') }}" class="btn-secondary">Volver a la tienda</a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function() {
  const canvas = document.getElementById("starfield");
  if (!canvas) return;
  const ctx = canvas.getContext("2d");

  let stars = [];
  const STAR_COUNT = 720;      // suficientes pero fluidas
  const SPEED = 0.0010;        // ‚≠ê lento y elegante
  let w, h, cx, cy;

  // üé® Paleta final sin verde
  const STAR_COLORS = [
    "255,255,255",     // blanco brillante
    "240,220,255",     // blanco-lila
    "215,160,255",     // lila neon
    "255,150,255",     // rosa neon
    "255,210,170"      // dorado suave
  ];

  function genStar() {
    const r = Math.random();
    return {
      x: (Math.random() * 2 - 1) * w,
      y: (Math.random() * 2 - 1) * h,
      z: Math.random() * w,

      // ‚≠ê tama√±os variados
      size:
        r < 0.70 ? (Math.random() * 1 + 0.3) :
        r < 0.92 ? (Math.random() * 2 + 1) :
                   (Math.random() * 4 + 2),

      glow: r < 0.7 ? 7 : (r < 0.92 ? 14 : 24),

      color: STAR_COLORS[Math.floor(Math.random() * STAR_COLORS.length)]
    };
  }

  function resize() {
    const wrapper = document.querySelector(".main-wrapper");
    const rect = wrapper.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;

    w = canvas.width;
    h = canvas.height;
    cx = w / 2;
    cy = h / 2;

    stars = [];
    for (let i = 0; i < STAR_COUNT; i++) stars.push(genStar());
  }

  function update() {
    // üåë fondo ultra negro morado
    ctx.fillStyle = "#010006"; 
    ctx.fillRect(0, 0, w, h);

    for (let s of stars) {
      s.z -= SPEED * w;

      if (s.z <= 1) {
        Object.assign(s, genStar());
        s.z = w;
      }

      const k = 150 / s.z;
      const px = s.x * k + cx;
      const py = s.y * k + cy;

      if (px < 0 || px >= w || py < 0 || py >= h) continue;

      const brightness = 1 - s.z / w;
      const alpha = 0.18 + brightness * 0.85;

      // ‚≠ê halo neon suave
      ctx.beginPath();
      ctx.fillStyle = `rgba(${s.color}, ${alpha})`;
      ctx.shadowBlur = s.glow;
      ctx.shadowColor = `rgba(${s.color}, ${alpha})`;
      ctx.arc(px, py, s.size, 0, Math.PI * 2);
      ctx.fill();
    }

    ctx.shadowBlur = 0;
    requestAnimationFrame(update);
  }

  window.addEventListener("resize", resize);
  resize();
  update();

})();
</script>
{% endblock %}

