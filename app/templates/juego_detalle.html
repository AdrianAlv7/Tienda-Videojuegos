{% extends 'base.html' %}
{% block title %}{{ juego.nombre }} - Tienda{% endblock %}

{%block extra_css%}
<link rel="stylesheet" href="{{ url_for('static', filename='css/juego_detalle.css') }}?v=2">
{%endblock%}

{% block content %}
<div class="detalle-volver">
    <a href="{{ back_url }}" class="btn-volver">â¬… Regresar</a>
</div>




<div class="detalle-container">
    <div class="detalle-imagen">
        <img src="{{ url_for('static', filename='IMG/productos/' + (juego.imagen or 'default.png')) }}" alt="{{ juego.nombre }}">
    </div>
    <div class="detalle-info">
  <h1>{{ juego.nombre }}</h1>
  <p>{{ juego.descripcion }}</p>
  <div class="precio">${{ juego.precio }}</div>

  {% if juego.en_biblioteca %}
    <!-- Si ya lo tiene -->
    <a href="{{ url_for('main.descargar_juego_imagen', nombre_imagen=juego.imagen, nombre_juego=juego.nombre) }}"
   class="btn-comprar" style="background:#555;">ğŸ® Jugar</a>

  {% else %}
    <!-- Si no lo tiene -->
<button 
    class="btn-gamer-detail 
        {% if juego.estado == 'biblioteca' %}btn-biblio
        {% elif juego.estado == 'carrito' %}btn-carrito
        {% else %}btn-agregar{% endif %}"
        
    data-product-id="{{ juego.id }}"
    data-state="{{ juego.estado }}">

{% if juego.estado == 'biblioteca' %}
    En biblioteca
{% elif juego.estado == 'carrito' %}
    En carrito
{% else %}
    ğŸ›’ Agregar al carrito
{% endif %}


  {% endif %}
</div>

</div>

<div class="galeria">
  <div class="galeria">
  <h3>Capturas del juego</h3>
  <div class="galeria-imgs">
    {% for img in juego.galeria %}
      <img src="{{ url_for('static', filename='IMG/productos/' + img) }}" alt="Captura de {{ juego.nombre }}">
    {% else %}
      <p>No hay imÃ¡genes adicionales aÃºn.</p>
    {% endfor %}
  </div>
</div>

<!-- MODAL GALERIA -->
<div id="modalGaleria" class="modal-galeria">
  <span id="cerrarGaleria" class="cerrar-galeria">âœ•</span>
  <img id="modalGaleriaImg" src="" alt="">
  <span id="galeriaPrev" class="nav-galeria prev">â®</span>
  <span id="galeriaNext" class="nav-galeria next">â¯</span>
</div>

</div>


    </div>
</div>
{% endblock %}


{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const imgs = document.querySelectorAll(".galeria-imgs img");
    const modal = document.getElementById("modalGaleria");
    const modalImg = document.getElementById("modalGaleriaImg");
    const cerrar = document.getElementById("cerrarGaleria");
    const prev = document.getElementById("galeriaPrev");
    const next = document.getElementById("galeriaNext");

    let index = 0;

    function showImg(i) {
        index = i;
        modalImg.src = imgs[index].src;
        modal.style.display = "flex";
    }

    imgs.forEach((img, i) => {
        img.addEventListener("click", () => showImg(i));
    });

    cerrar.addEventListener("click", () => modal.style.display = "none");

    prev.addEventListener("click", () => {
        index = (index - 1 + imgs.length) % imgs.length;
        showImg(index);
    });

    next.addEventListener("click", () => {
        index = (index + 1) % imgs.length;
        showImg(index);
    });

    modal.addEventListener("click", e => {
        if (e.target === modal) modal.style.display = "none";
    });

    document.addEventListener("keydown", e => {
        if (modal.style.display === "flex") {
            if (e.key === "ArrowLeft") prev.click();
            if (e.key === "ArrowRight") next.click();
            if (e.key === "Escape") modal.style.display = "none";
        }
    });
});
</script>
{% endblock %}
